Markdown

# Nginx Stream Manager (NSM)

![Version](https://img.shields.io/badge/Version-1.0.1%20(Stable)-blue)
![License](https://img.shields.io/github/license/pansir0290/nginx-stream-manager?color=orange)
![OS Compatibility](https://img.shields.io/badge/OS-Debian%20%7C%20Ubuntu%20%7C%20CentOS-green)

Nginx Stream Manager (NSM) æ˜¯ä¸€ä¸ªç®€å•ã€æ˜“ç”¨çš„ Shell è„šæœ¬å·¥å…·ï¼Œæ—¨åœ¨å¸®åŠ© Linux ç”¨æˆ·å¿«é€Ÿé…ç½®å’Œç®¡ç† Nginx çš„ Stream æ¨¡å—ï¼ˆå››å±‚ä»£ç†ï¼‰ï¼Œå®ç° TCP/UDP ç«¯å£çš„è½¬å‘ä¸ä»£ç†ã€‚ç‰¹åˆ«æ”¯æŒ SSL/TLS é¢„è¯»åŠŸèƒ½ï¼Œç”¨äºæ ¹æ® SNI è·¯ç”±æµé‡ã€‚

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

* **ç«¯å£è½¬å‘:** è½»æ¾è®¾ç½® TCP å’Œ UDP ç«¯å£è½¬å‘åˆ°ç›®æ ‡ IP å’Œç«¯å£ã€‚
* **SSL é¢„è¯»æ”¯æŒ:** åˆ©ç”¨ Nginx çš„ `ssl_preread` åŠŸèƒ½ï¼Œæ ¹æ®å®¢æˆ·ç«¯è¯·æ±‚çš„ SNI ä¿¡æ¯è¿›è¡Œæ›´æ™ºèƒ½çš„ä»£ç†ã€‚
* **é…ç½®ç®¡ç†:** è‡ªåŠ¨æ·»åŠ ã€ä¿®æ”¹å’Œåˆ é™¤ Stream ä»£ç†è§„åˆ™ã€‚
* **æœåŠ¡æ§åˆ¶:** ä¸€é”®é‡å¯/é‡è½½ Nginx æœåŠ¡ä»¥åº”ç”¨é…ç½®ã€‚
* **ç¯å¢ƒæ£€æŸ¥:** è‡ªåŠ¨æ£€æŸ¥ Nginx æ ¸å¿ƒé…ç½®å’Œ Stream æ¨¡å—çš„åŠ è½½çŠ¶æ€ã€‚

## ğŸ“‹ å…¼å®¹æ€§è¦æ±‚

æœ¬è„šæœ¬è¦æ±‚æ‚¨çš„ç³»ç»Ÿæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š

1.  **æ“ä½œç³»ç»Ÿ:** å…¼å®¹ä¸»æµ Linux å‘è¡Œç‰ˆ (Debian 10+, Ubuntu 18.04+, CentOS 7+)ã€‚
2.  **æƒé™:** å¿…é¡»ä»¥ `root` ç”¨æˆ·æˆ–å…·æœ‰ `sudo` æƒé™çš„ç”¨æˆ·è¿è¡Œã€‚
3.  **æ ¸å¿ƒç»„ä»¶:** `curl`, `nginx`, `sudo`, `vim` æˆ– `nano`ã€‚

## ğŸ’¡ å®‰è£…ä¾èµ–

åœ¨è¿è¡Œéƒ¨ç½²è„šæœ¬ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„ç³»ç»Ÿå·²å®‰è£…æ‰€æœ‰å¿…è¦çš„ç»„ä»¶ã€‚

**å¯¹äº Debian/Ubuntu ç³»ç»Ÿ:**

```bash
sudo apt update
sudo apt install -y curl vim sudo nginx net-tools iproute2

å¯¹äº CentOS/RHEL/Fedora ç³»ç»Ÿ:
Bash

sudo yum install -y curl vim sudo nginx net-tools iproute2
# æˆ–ä½¿ç”¨ dnf
# sudo dnf install -y curl vim sudo nginx net-tools iproute2

    æ³¨æ„ï¼š net-tools æˆ– iproute2 ç”¨äºç«¯å£å ç”¨æ£€æŸ¥ã€‚å¦‚æœæ‚¨çš„ Nginx æ˜¯ä»æºç ç¼–è¯‘å®‰è£…ï¼Œè¯·ç¡®ä¿å·²å¯ç”¨ ngx_stream_module å’Œ ngx_stream_ssl_moduleã€‚

ğŸ› ï¸ éƒ¨ç½²è„šæœ¬

æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯éƒ¨ç½² Nginx Stream Manager (NSM)ã€‚è„šæœ¬ä¼šè‡ªåŠ¨ä¸‹è½½ã€å®‰è£…å¹¶é…ç½®ç¯å¢ƒï¼Œç„¶ååˆ›å»ºåˆ«åã€‚
Bash

sudo curl -fsSL [https://raw.githubusercontent.com/pansir0290/nginx-stream-manager/main/deploy.sh](https://raw.githubusercontent.com/pansir0290/nginx-stream-manager/main/deploy.sh) | bash

è¿è¡Œå®Œæˆåï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥ç¡®ä¿ nsm å‘½ä»¤åˆ«åç”Ÿæ•ˆï¼š
Bash

source ~/.bashrc

ğŸ–¥ï¸ ä½¿ç”¨æ–¹æ³•

éƒ¨ç½²æˆåŠŸåï¼Œåªéœ€åœ¨ç»ˆç«¯è¾“å…¥ nsm å³å¯å¯åŠ¨ç®¡ç†èœå•ã€‚
Bash

nsm

ä¸»èœå•é€‰é¡¹è¯´æ˜

é€‰é¡¹	å‘½ä»¤	æè¿°
1	æ·»åŠ æˆ–ä¿®æ”¹ä»£ç†è§„åˆ™	å¼•å¯¼å¼æ·»åŠ æ–°çš„ç«¯å£è½¬å‘è§„åˆ™ï¼Œæ”¯æŒ TCP/UDP å’Œ SSL é¢„è¯»é…ç½®ã€‚
2	åˆ é™¤ç°æœ‰ä»£ç†è§„åˆ™	æŸ¥çœ‹æ‰€æœ‰å·²é…ç½®çš„è§„åˆ™ï¼Œå¹¶æŒ‰åºå·åˆ é™¤æŒ‡å®šçš„è§„åˆ™ã€‚
3	é‡å¯ Nginx	æ£€æŸ¥ Nginx é…ç½®è¯­æ³•å¹¶é‡è½½/é‡å¯ Nginx æœåŠ¡ï¼Œä½¿è§„åˆ™ç”Ÿæ•ˆã€‚
4	ç³»ç»ŸçŠ¶æ€æ£€æŸ¥	æ£€æŸ¥ Nginx æœåŠ¡çŠ¶æ€ã€é…ç½®åŒ…å«çŠ¶æ€ã€Stream SSL æ¨¡å—åŠ è½½çŠ¶æ€ç­‰ã€‚
0	é€€å‡º NSM	é€€å‡ºç®¡ç†å·¥å…·ã€‚

â­ æ³¨æ„äº‹é¡¹ä¸æ•…éšœæ’æŸ¥

1. Nginx Stream æ¨¡å—

NSM ä¾èµ–äº Nginx çš„ Stream æ¨¡å—ã€‚å¤§å¤šæ•°å‘è¡Œç‰ˆå®‰è£…çš„ Nginx é»˜è®¤åŒ…å«è¯¥æ¨¡å—ã€‚å¦‚æœåœ¨ä½¿ç”¨ TCP/UDP æˆ– ssl_preread æ—¶æŠ¥é”™ï¼Œè¯·è¿è¡Œèœå•ä¸­çš„ 4) ç³»ç»ŸçŠ¶æ€æ£€æŸ¥ï¼Œå¹¶ç¡®ä¿ Nginx ä¸»é…ç½®æ–‡ä»¶ä¸­å·²æ­£ç¡®åŠ è½½ ngx_stream_ssl_module.soã€‚å¦‚æœç¼ºå¤±ï¼Œè„šæœ¬ä¼šå°è¯•è‡ªåŠ¨ä¿®å¤ã€‚

2. SELinux (CentOS/RHEL ç”¨æˆ·)

å¦‚æœæ‚¨çš„ç³»ç»Ÿå¯ç”¨äº† SELinuxï¼Œå¯èƒ½ä¼šé˜»æ­¢ Nginx ç›‘å¬é«˜æƒé™ç«¯å£ã€‚

    è„šæœ¬ä¼šå°è¯•ä¸´æ—¶ç¦ç”¨ SELinux (setenforce 0) å¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶æ°¸ä¹…ç¦ç”¨ã€‚

    å¼ºçƒˆå»ºè®®åœ¨éƒ¨ç½²åï¼Œé‡å¯ç³»ç»Ÿä½¿ SELinux æ°¸ä¹…ç¦ç”¨ç”Ÿæ•ˆï¼Œä»¥é¿å…åç»­ç«¯å£è½¬å‘å¤±è´¥ã€‚

3. é…ç½®è·¯å¾„

æ‰€æœ‰è§„åˆ™æ–‡ä»¶éƒ½å­˜å‚¨åœ¨ä»¥ä¸‹è·¯å¾„ï¼š

    ä¸»è§„åˆ™æ–‡ä»¶: /etc/nginx/conf.d/nsm/nsm-stream.conf

    å¤‡ä»½ç›®å½•: /etc/nginx/conf.d/nsm/backups

å¦‚æœé‡åˆ°é…ç½®é—®é¢˜ï¼Œæ‚¨å¯ä»¥æ‰‹åŠ¨æ£€æŸ¥æˆ–æ¢å¤å¤‡ä»½æ–‡ä»¶ã€‚

4. æ—¥å¿—æ–‡ä»¶

è„šæœ¬çš„æ‰€æœ‰æ“ä½œå’Œé”™è¯¯ä¿¡æ¯éƒ½ä¼šè®°å½•åœ¨ï¼š

    æ—¥å¿—æ–‡ä»¶: /var/log/nsm-manager.log

é‡åˆ°ä»»ä½•é—®é¢˜æ—¶ï¼ŒæŸ¥çœ‹æ­¤æ–‡ä»¶å¯ä»¥å¸®åŠ©æ‚¨å®šä½æ•…éšœã€‚

ğŸ“œ è®¸å¯åè®®

æœ¬é¡¹ç›®éµå¾ª MIT åè®®ã€‚
